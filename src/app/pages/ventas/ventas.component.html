<section class="section profile">
  <div class="row">
    <div class="col-xl-8">
      <div class="card">
        <div class="card-body">
          <div class="row">
            <div class="col-xl-6 col-lg-6 col-md-6">
              <input-debounce
                #input
                [delay]="500"
                id="inputProducto"
                height="15px"
                type="text"
                placeholder="Buscar"
                required=""
                aria-invalid="false"
                (value)="buscar($event)"
              >
              </input-debounce>
            </div>
            <div class="col-xl-3 col-lg-3 col-md-3">
              <app-incrementador
                [cantidad]="cantidad"
                (change)="cantidad = $event"
              ></app-incrementador>
            </div>
            <div class="col-xl-3 col-lg-3 col-md-3">
              <!-- <label class="small text-uppercase m-1" for="categorias">Categorías:</label> -->
              <!--  <ng-select-categoria *ngIf="!deshabilitarBuscador" #searchCategoria id="ngSelectCategoria"
                    [cargadorCategoria]="categoriaSeleccionada" name="ngSelectCategoria"
                    (retornoObjeto)="filtrarCategoria($event)">
                </ng-select-categoria> -->
            </div>
          </div>
      <!--     <div class="product-container">
            @for (producto of productos(); track producto.id) {
            <app-product-card
              (productClicked)="seleccionarProducto($event)"
              [producto]="producto"
            ></app-product-card>
            } @empty {
              <div class="w-100 empty-message-container">
                <div class="alert alert-info alert-dismissible fade show" role="alert">
                  <h4 class="alert-heading">Atención</h4>
                  <p>No se han encontrado productos...</p>
                </div>
              </div>
            }
          </div> -->
         <div id="products">
            <div class="row product-card-container">
              @for (producto of productos(); track producto.id) {
              <app-product-card
                (productClicked)="seleccionarProducto($event)"
                [producto]="producto"
              ></app-product-card>
              } @empty {
                <div class="w-100  ">
                  <div class="alert alert-info alert-dismissible fade show" role="alert">
                    <h4 class="alert-heading">Atención</h4>
                    <p>No se han encontrado productos...</p>
                  </div>
                </div>
              }
            </div>
          </div>

          <!--      <div class="row">
            @for (producto of productos(); track producto.id) {
              <div class="col-sm-6 col-sm-4 col-md-3 col-lg-2 col-xl-2">
                <app-product-card
                  (productClicked)="seleccionarProducto($event)"
                  [producto]="producto"
                ></app-product-card>
              </div>
            } @empty {
              <li class="list-group-item">No se han encontrado items</li>
            }
          </div>   -->
          <div class="d-flex justify-content-center">
            <app-paginator
              [totalPages]="totalPages()"
              [currentPage]="page()"
              (pageChanged)="onPageChanged($event)"
            >
            </app-paginator>
          </div>
        </div>
      </div>
    </div>
    <div class="col-xl-4">
      <!--   selectores -->
      <div class="card">
        <div class="card-body pt-4 d-flex flex-column align-items-center">
          <div class="input-group mb-3 w-100 d-flex selector">
            <span
              (click)="abrirBuscador()"
              class="input-group-text flex-grow-1 d-flex justify-content-between btn-outline-success text-success"
              id="basic-addon3"
            >
              @if(cliente().nroDocumento != '') {
              <span class="client-info"
                >{{ cliente().nroDocumento }} -
                {{ cliente().razonSocial }}</span
              >
              } @else {
              <span class="client-info">cargando ...</span>
              }
              <span class="dropdown-icon">
                <i class="mh-1 fa-solid fa-sort-down"></i>
              </span>
            </span>
            <span
              class="input-group-text btn-outline-success text-success"
              id="basic-addon3"
            >
              <i class="fa-solid fa-user-plus"></i>
            </span>
          </div>

          <div class="d-flex w-100">
            <!-- Agrupación de Sucursal y Serie -->
            <div class="input-group mb-3 w-50 d-flex selector">
              <span
                class="input-group-text flex-grow-1 d-flex justify-content-between"
                id="basic-addon3"
              >
                @if(sucursal().id) {
                <span class="client-info"
                  >Sucursal <small>{{ sucursal().descripcion }}</small></span
                >
                } @else {
                <span class="client-info"><small>cargando ...</small></span>
                }
                <span class="dropdown-icon">
                  <i class="mh-1 fa-solid fa-sort-down"></i>
                </span>
              </span>
            </div>

            <div class="input-group mb-3 w-50 d-flex selector">
              <span
                class="input-group-text flex-grow-1 d-flex justify-content-between"
                id="basic-addon3"
              >
                @if(numeracion().id) {
                <span class="client-info"
                  >Serie: <small>{{ numeracion().serie }}</small>
                </span>
                } @else {
                <span class="client-info"><small>cargando ...</small></span>
                }
                <span class="dropdown-icon">
                  <i class="mh-1 fa-solid fa-sort-down"></i>
                </span>
              </span>
            </div>
          </div>

          <div class="d-flex w-100">
            <!-- Agrupación de Forma de Venta y Lista de Precio -->
            <div class="input-group mb-3 p w-50 d-flex selector">
              <span
                class="input-group-text flex-grow-1 d-flex justify-content-between"
                id="basic-addon3"
              >
                @if(formaVenta().id) {
                <span class="client-info"
                  >Forma venta:
                  <small>{{ formaVenta().descripcion }}</small></span
                >
                } @else {
                <span class="client-info"><small>cargando ...</small></span>
                }
                <span class="dropdown-icon">
                  <i class="mh-1 fa-solid fa-sort-down"></i>
                </span>
              </span>
            </div>

            <div class="input-group mb-3 w-50 d-flex selector">
              <span
                class="input-group-text flex-grow-1 d-flex justify-content-between"
                id="basic-addon3"
              >
                @if(listaPrecio().id) {
                <span class="client-info"
                  >Lista Precio: <small>{{ listaPrecio().descripcion }}</small>
                </span>
                } @else {
                <span class="client-info"><small>cargando ...</small></span>
                }
                <span class="dropdown-icon">
                  <i class="mh-1 fa-solid fa-sort-down"></i>
                </span>
              </span>
            </div>
          </div>
        </div>
      </div>

      <!--   detalles -->
      <div class="card">
        <div class="card-body pt-4 d-flex flex-column align-items-center">
          <div id="details">
            <table class="table caption-top">
              <caption>
                Items({{
                  detalles?.length | number
                }})
              </caption>
              <thead>
                <tr>
                  <th scope="col">Cant.</th>
                  <th scope="col">Producto</th>
                  <th scope="col">Precio</th>
                  <th scope="col">Total</th>
                  <th scope="col">Del</th>
                </tr>
              </thead>
              <tbody>
                <!--                 @for (detalle of detalles; track detalle.varianteId; let index = $index) { -->
                @for (detalle of detalles; track detalle.varianteId; let index =
                $index) {
                <tr>
                  <th scope="row">{{ detalle.cantidad | number }}</th>
                  <td>{{ detalle.codErp }}</td>
                  <td>{{ detalle.importePrecio | number }} Gs</td>
                  <td>{{ detalle.importeTotal | number }} Gs</td>
                  <td>
                    <button class="btn btn-sm btn-outline-danger text-danger">
                      <i class="bi bi-trash3"></i>
                    </button>
                  </td>
                </tr>
                } @empty {
                <tr></tr>
                }
              </tbody>
            </table>
          </div>
        </div>
      </div>

      <!--   totales -->
      <div class="card">
        <div class="card-body">
          <!--   <h5 class="card-title">Totales <span> </span></h5> -->
          <div class="d-flex align-items-center">
            <div class="ps-3">
              <span class="text-danger small pt-1 fw-bold">Subtotal</span>
              <h6 class="text-right">
                {{ factura().importeSubtotal | number }} Gs
              </h6>
            </div>

            <div class="ps-3">
              <span class="text-danger small pt-1 fw-bold">Descuento</span>
              <h6 class="text-right">
                {{ factura().importeDescuento | number }} Gs
              </h6>
            </div>

            <div class="ps-3">
              <span class="text-danger small pt-1 fw-bold">Total</span>
              <h6 class="text-right font-weight-bold">
                {{ factura().importeTotal | number }} Gs
              </h6>
            </div>
          </div>
        </div>
      </div>
      <!--   botones -->
      <div class="card">
        <div class="card-body btn-group">
          <button type="button" class="btn btn-outline-success">Pagar</button>
          <button type="button" class="btn btn-outline-danger">Cancelar</button>
        </div>
      </div>
    </div>
  </div>
</section>
<!-- selector de cliente-->
@if(searchCliente ) {
<app-cliente-search
  [isOpen]="searchCliente"
  (cliente)="selectCliente($event)"
  (closeModal)="searchCliente = false"
></app-cliente-search>
}
