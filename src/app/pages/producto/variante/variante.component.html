<div class="card">
  <div class="card-header">Variantes</div>

  <div class="card-body">
    <div id="details" style="overflow-x: auto">
      <table class="table table-responsive-sm table-striped table-sm mt-2">
        <thead>
          <tr>
            <th scope="col">ID</th>
            <th scope="col">IMG</th>
            <th scope="col">CODBARRA</th>
            <th scope="col">CODERP</th>
            <th scope="col">%IVA</th>
            <th scope="col">PRODUCTO</th>
            <th scope="col">PRESENTACION</th>
            <th scope="col">VARIEADAD</th>
            <th scope="col">UNIDAD</th>
            <th scope="col">ACTIVO</th>
            <th scope="col">ACCION</th>
          </tr>
        </thead>
        <tbody>
          @for (variante of variantes(); track variante.id; let index = $index)
          {
          <tr>
            <td class="text-sm">{{ variante.id }}</td>
            <td
              align="center"
              class="w70"
              align="center"
              style="background: white"
            >
              <img
                *ngIf="variante.img"
                [attr.src]="variante.img | imagen: 'productos' | async"
                class="img-producto60"
              />
            </td>
            <td class="text-sm">
              <input
                type="text"
                class="form-control form-control-sm"
                [(ngModel)]="variante.codBarra"
              />
            </td>
            <td class="text-sm">
              <input
                type="text"
                class="form-control form-control-sm"
                [(ngModel)]="variante.codErp"
              />
            </td>
            <td class="text-sm">
              <input
                type="text"
                class="form-control form-control-sm"
                [(ngModel)]="variante.porcIva"
              />
            </td>
            <td class="text-sm">
              <select
                class="custom-select"
                [(ngModel)]="variante.productoId"
                class="sm"
              >
                <option
                  *ngFor="let producto of productos()"
                  [value]="producto.id"
                >
                  {{ producto.nombre }}
                </option>
              </select>
            </td>

            <td class="text-sm">
              <select
                class="custom-select custom-select-sm"
                [(ngModel)]="variante.presentacionId"
                class="sm"
              >
                <option
                  *ngFor="let presentacion of presentaciones()"
                  [value]="presentacion.id"
                >
                  {{ presentacion.descripcion }}
                </option>
              </select>
            </td>
            <td class="text-sm">
              <select
                class="custom-select custom-select-sm"
                [(ngModel)]="variante.variedadId"
                class="sm"
              >
                <option
                  *ngFor="let variedad of variedades()"
                  [value]="variedad.id"
                >
                  {{ variedad.descripcion }}
                </option>
              </select>
            </td>
            <td class="text-sm">
              <select
                class="custom-select custom-select-sm"
                [(ngModel)]="variante.unidadId"
                class="sm"
              >
                <option *ngFor="let unidad of unidades()" [value]="unidad.id">
                  {{ unidad.descripcion }}
                </option>
              </select>
            </td>
            <td class="text-sm form-check form-switch">
              <input type="checkbox" [(ngModel)]="variante.activo" />
            </td>
            <td class="text-sm">
              <button (click)="actualizar(variante)">Guardar</button>
            </td>
          </tr>
          } @empty {
          <tr></tr>
          }
        </tbody>
      </table>
      <table
        class="table table-responsive-sm table-striped table-sm mt-2"
        id="tableProducts"
      >
        <thead>
          <tr>
            <th>Id</th>
            <th>Código</th>
            <th>Código barra</th>
            <th>UM</th>
            <th>Producto</th>
            <th>Presentación</th>
            <th>Variedad</th>
            <th>%Iva</th>
            <th>Activo</th>

            <th>Imagen</th>

            <th></th>
          </tr>
        </thead>

        <tbody id="internal_products_list">
          @for (variante of variantes(); track variante.id; let index = $index)
          {
          <tr class=" ">
            <td class="field">{{ variante.id }}</td>
            <td class="field">
              <input
                class="form-control form-control-sm validation"
                [(ngModel)]="variante.codErp"
                type="number"
                name="codErp"
                id="codErp"
              />
            </td>
            <td class="field">
              <input
                class="form-control form-control-sm  validation"
                [(ngModel)]="variante.codBarra"
                type="number"
                name="codBarra"
                id="codBarra"
              />
            </td>
            <td class="field">
              <select
                class="custom-select custom-select-sm"
                id="unidadId"
                [(ngModel)]="variante.unidadId"
              >
                <option *ngFor="let unidad of unidades()" [value]="unidad.id">
                  {{ unidad.descripcion }}
                </option>
              </select>
            </td>

            <td class="field">
              <select
                class="custom-select custom-select-sm"
                id="productoId"
                [(ngModel)]="variante.productoId"
              >
                <option
                  *ngFor="let producto of productos()"
                  [value]="producto.id"
                >
                  {{ producto.nombre }}
                </option>
              </select>
            </td>

            <td class="field">
              <select
                class="custom-select custom-select-sm"
                id="presentacionId"
                [(ngModel)]="variante.presentacionId"
              >
                <option
                  *ngFor="let presentacion of presentaciones()"
                  [value]="presentacion.id"
                >
                  {{ presentacion.descripcion }}
                </option>
              </select>
            </td>

            <td class="field">
              <select
                class="custom-select custom-select-sm"
                id="variedadId"
                [(ngModel)]="variante.variedadId"
              >
                <option
                  *ngFor="let variedad of variedades()"
                  [value]="variedad.id"
                >
                  {{ variedad.descripcion }}
                </option>
              </select>
            </td>

            <td class="field">
              <input
                class="form-control form-control-sm  validation"
                [(ngModel)]="variante.porcIva"
                type="number"
                name="porcIva"
                id="porcIva"
              />
            </td>

            <td class="field">
              <label
                class="c-switch c-switch-sm c-switch-pill c-switch-warning"
              >
                <input
                  name="product[internal_products_attributes][0][featured]"
                  type="hidden"
                  value="0"
                /><input
                  class="c-switch-input"
                  type="checkbox"
                  value="1"
                  name="product[internal_products_attributes][0][featured]"
                  id="product_internal_products_attributes_0_featured"
                />
                <span class="c-switch-slider"></span>
              </label>
            </td>

            <td
            align="center"
            class="w70"
            align="center"
            style="background: white"
          >
            <img
              *ngIf="variante.img"
              [attr.src]="variante.img | imagen: 'productos' | async"
              class="img-producto60"
            />
          </td>
            <td class="field">
              <input
                value="false"
                type="hidden"
                name="product[internal_products_attributes][0][_destroy]"
                id="product_internal_products_attributes_0__destroy"
              /><a class="btn btn-danger remove_fields existing" href="#"
                ><i
                  class="c-icon cil-trash"
                  data-toggle="tooltip"
                  title="Eliminar"
                ></i
              ></a>
            </td>
          </tr>
          }@empty { }
        </tbody>
      </table>
    </div>
  </div>
</div>
